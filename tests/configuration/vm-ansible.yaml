---
module: github.com/stuttgart-things/blueprints/vm
version: v1.13.0
function: bake-local

general:
  parameters:
    - vault-url=env:VAULT_ADDR
    - vault-secret-id=env:VAULT_SECRET_ID
    - vault-role-id=env:VAULT_ROLE_ID
    - variables="vault_addr=$VAULT_ADDR"
    - ansible-requirements-file=./requirements.yaml
    - ansible-wait-timeout=90
    - terraform-dir=./
    - ansible-user=env:SSH_USER
    - ansible-password=env:SSH_PASSWORD
    - progress=plain -vv

profiles:
  baseos:
    variables:
      vault_addr: https://vault-vsphere.tiab.labda.sva.de:8200
    parameters:
      - ansible-inventory-type=default
    playbooks:
      - sthings.baseos.setup
    ansibleVars:
      send_to_homerun: false
  rke2:
    playbooks:
      - sthings.baseos.setup
      - sthings.rke.rke2
      - sthings.rke.upload_kubeconfig_vault
    parameters:
      - ansible-inventory-type=cluster
    ansibleVars:
      clusterName: whatever
    optionalAnsibleVars:
      registry_mirror_url: ""
      cilium_lbrange_start_ip: "" #10.31.103.10
      cilium_lbrange_stop_ip: "" #10.31.103.12
